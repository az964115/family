<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>即時股票資訊示範</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #info { margin-top: 20px; }
    .field { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>股票資訊抓取示範</h1>
  <input type="text" id="symbolInput" placeholder="輸入股票代碼（如 2454）" />
  <button onclick="loadStock()">查詢</button>

  <div id="info">
    <div class="field"><strong>名稱：</strong><span id="name"></span></div>
    <div class="field"><strong>代碼：</strong><span id="code"></span></div>
    <div class="field"><strong>類別：</strong><span id="category"></span></div>
    <div class="field"><strong>價格：</strong><span id="price"></span></div>
  </div>

  <script>
    async function loadStock() {
      const symbol = document.getElementById("symbolInput").value.trim();
      if (!symbol) {
        alert("請輸入股票代碼");
        return;
      }

      const url = `https://tw.stock.yahoo.com/quote/${symbol}.TW`;

      try {
        const resp = await fetch(url);
        const html = await resp.text();
        // 用 DOMParser 把 HTML 轉成 document
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        // 從你提供的範例中抓取
        const h1 = doc.querySelector("h1.C\\(\\$c-link-text\\).Fw\\(b\\).Fz\\(24px\\).Mend\\(8px\\)");
        const spanCode = doc.querySelector("span.C\\(\\$c-icon\\).Fz\\(24px\\).Mend\\(20px\\)");
        const aCategory = doc.querySelector("a.Td\\(n\\).Px\\(8px\\).Py\\(3px\\).Fz\\(12px\\).Fw\\(b\\).Bdrs\\(11px\\).C\\(#188fff\\)");
        const spanPrice = doc.querySelector("span.Fz\\(32px\\).Fw\\(b\\).Lh\\(1\\).Mend\\(16px\\).D\\(f\\).Ai\\(c\\).C\\(\\$c-trend-up\\)");

        document.getElementById("name").textContent = h1 ? h1.textContent : "無法取得";
        document.getElementById("code").textContent = spanCode ? spanCode.textContent : "無法取得";
        document.getElementById("category").textContent = aCategory ? aCategory.textContent : "無法取得";
        document.getElementById("price").textContent = spanPrice ? spanPrice.textContent : "無法取得";

      } catch (err) {
        console.error("錯誤：", err);
        alert("擷取失敗：可能被 CORS 擋住或網頁改版了");
      }
    }
  </script>
</body>
</html>
