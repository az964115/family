<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ· è±¬è±¬å…§ç¶² - å¤šåŠŸèƒ½ç¸½è¦½</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 720px;
      margin: 20px auto;
      padding: 20px;
      background: #fff9f0;
      color: #333;
      line-height: 1.6;
    }
    h1, h2 {
      text-align: center;
      color: #d35400;
    }
    .section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px #f0b27a88;
      padding: 15px 25px;
      margin-bottom: 25px;
    }
    .section h2 {
      margin-bottom: 15px;
      border-bottom: 2px solid #f39c12;
      padding-bottom: 5px;
    }
    #weatherIcon {
      vertical-align: middle;
      width: 40px;
      height: 40px;
    }
    .quote {
      font-style: italic;
      font-size: 1.2rem;
      color: #6e2c00;
      margin: 15px 0;
      text-align: center;
    }
    .news-list {
      list-style: none;
      padding: 0;
    }
    .news-list li {
      margin-bottom: 10px;
    }
    .news-list a {
      color: #d35400;
      text-decoration: none;
    }
    .news-list a:hover {
      text-decoration: underline;
    }
    #stockChange {
      font-weight: bold;
    }
    .stock-up {
      color: red;
    }
    .stock-down {
      color: green;
    }
    .tools {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: space-around;
    }
    .tool-box {
      border: 1px solid #f0b27a;
      border-radius: 8px;
      padding: 15px;
      width: 320px;
      background: #fff3e0;
      box-shadow: 2px 2px 8px #f7d6a7;
    }
    input[type="number"], input[type="text"] {
      width: 100%;
      padding: 6px;
      font-size: 1rem;
      margin-bottom: 10px;
      border: 1px solid #d35400;
      border-radius: 4px;
    }
    button {
      background-color: #d35400;
      border: none;
      color: white;
      padding: 10px 15px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    button:hover {
      background-color: #e67e22;
    }
    #countdownDisplay {
      font-size: 2rem;
      color: #af601a;
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }
    @media (max-width: 700px) {
      .tools {
        flex-direction: column;
        align-items: center;
      }
      .tool-box {
        width: 90%;
      }
    }
  </style>
</head>
<body>

  <h1>ğŸ· è±¬è±¬å…§ç¶² - å¤šåŠŸèƒ½ç¸½è¦½</h1>

  <!-- å¤©æ°£è³‡è¨Šå€ -->
  <section class="section" id="weatherSection">
    <h2>ğŸ“ å¤©æ°£è³‡è¨Š</h2>
    <div>
      <strong>åŸå¸‚ï¼š</strong><span id="city">è®€å–ä¸­...</span><br />
      <strong>å¤©æ°£ï¼š</strong><img id="weatherIcon" src="" alt="weather icon" /> <span id="weatherDesc">è®€å–ä¸­...</span><br />
      <strong>æº«åº¦ï¼š</strong><span id="temp">--</span> â„ƒ<br />
      <strong>æ¿•åº¦ï¼š</strong><span id="humidity">--</span> %
    </div>
  </section>

  <!-- æ¯æ—¥ä¸€å¥ -->
  <section class="section" id="quoteSection">
    <h2>ğŸ’¡ æ¯æ—¥ä¸€å¥å‹µå¿—èªéŒ„</h2>
    <div class="quote" id="dailyQuote">è®€å–ä¸­...</div>
  </section>

  <!-- æ–°èç°¡å ± -->
  <section class="section" id="newsSection">
    <h2>ğŸ“° ä»Šæ—¥ç†±é–€æ–°è</h2>
    <ul class="news-list" id="newsList">
      <li>è®€å–ä¸­...</li>
    </ul>
  </section>

  <!-- è‚¡å¸‚ç¸½è¦½ -->
  <section class="section" id="stockSection">
    <h2>ğŸ“ˆ å°ç£è‚¡å¸‚ç¸½è¦½</h2>
    <input type="text" id="symbolInput" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼ˆå¦‚ 2330ï¼‰" />
    <button onclick="loadStock()">æŸ¥è©¢</button>
    <div id="stockInfo" style="margin-top: 15px;">
      <div><strong>åç¨±ï¼š</strong><span id="name"></span></div>
      <div><strong>ä»£ç¢¼ï¼š</strong><span id="code"></span></div>
      <div><strong>æœ€æ–°æˆäº¤åƒ¹ï¼š</strong><span id="price"></span></div>
      <div><strong>æ˜¨æ—¥æ”¶ç›¤ï¼š</strong><span id="yesterdayClose"></span></div>
      <div><strong>æ¼²è·Œï¼š</strong><span id="change" id="stockChange"></span></div>
      <div><strong>æˆäº¤é‡ï¼š</strong><span id="volume"></span></div>
      <div><strong>æ˜¨æ—¥æˆäº¤é‡ï¼š</strong><span id="yesterdayVolume"></span></div>
    </div>
    <canvas id="chart" style="margin-top:15px;"></canvas>
  </section>

  <!-- å°å·¥å…·å€ -->
  <section class="section" id="toolsSection">
    <h2>ğŸ›  å°å·¥å…·å€</h2>
    <div class="tools">
      <!-- è¨ˆç®—æ©Ÿ -->
      <div class="tool-box" id="calculatorBox">
        <h3>è¨ˆç®—æ©Ÿ</h3>
        <input type="text" id="calcInput" placeholder="è¼¸å…¥ç®—å¼ï¼Œä¾‹å¦‚ï¼š3+4*2" />
        <button onclick="calculate()">è¨ˆç®—</button>
        <div id="calcResult" style="margin-top: 10px; font-weight:bold;"></div>
      </div>

      <!-- å€’æ•¸è¨ˆæ™‚å™¨ -->
      <div class="tool-box" id="countdownBox">
        <h3>å€’æ•¸è¨ˆæ™‚å™¨</h3>
        <input type="number" id="countdownInput" placeholder="è¼¸å…¥ç§’æ•¸" />
        <button onclick="startCountdown()">é–‹å§‹å€’æ•¸</button>
        <div id="countdownDisplay"></div>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // å¤©æ°£APIè¨­å®šï¼ˆè«‹å…ˆè‡ªè¡Œç”³è«‹OpenWeatherMapå…è²»API KEYï¼‰
    const weatherApiKey = '67fc7a1bcf794a2c46fc07c639b0048d';
    const cityName = 'Taoyuan'; // ä½ ä¹Ÿå¯ä»¥ç”¨å‹•æ…‹å®šä½å–å¾—åŸå¸‚

    async function loadWeather() {
      try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${weatherApiKey}&units=metric&lang=zh_tw`);
        const data = await res.json();
        if (data.cod !== 200) {
          document.getElementById('city').textContent = 'ç„¡æ³•å–å¾—å¤©æ°£';
          document.getElementById('weatherDesc').textContent = '';
          return;
        }
        document.getElementById('city').textContent = data.name;
        document.getElementById('temp').textContent = data.main.temp.toFixed(1);
        document.getElementById('humidity').textContent = data.main.humidity;
        document.getElementById('weatherDesc').textContent = data.weather[0].description;
        document.getElementById('weatherIcon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}.png`;
      } catch (e) {
        document.getElementById('city').textContent = 'éŒ¯èª¤ç™¼ç”Ÿ';
        document.getElementById('weatherDesc').textContent = '';
        console.error(e);
      }
    }

    // æ¯æ—¥ä¸€å¥å‹µå¿—èªéŒ„é™£åˆ—
    const quotes = [
      "æˆåŠŸä¸æ˜¯çµ‚é»ï¼Œå¤±æ•—ä¹Ÿä¸æ˜¯çµ‚çµï¼Œæœ€é‡è¦çš„æ˜¯ç¹¼çºŒå‰é€²ã€‚",
      "å­¸ç¿’å¦‚é€†æ°´è¡ŒèˆŸï¼Œä¸é€²å‰‡é€€ã€‚",
      "ä½ çš„æ™‚é–“æœ‰é™ï¼Œä¸è¦æµªè²»æ–¼é‡è¤‡åˆ¥äººçš„ç”Ÿæ´»ã€‚",
      "ä¸ç¶“æ­·é¢¨é›¨ï¼Œæ€èƒ½è¦‹å½©è™¹ï¼Ÿ",
      "å¿ƒæœ‰å¤šå¤§ï¼Œèˆå°å°±æœ‰å¤šå¤§ã€‚",
      "å›°é›£æ˜¯æˆåŠŸçš„å¢Šè…³çŸ³ï¼Œå‹‡æ•¢è¿æ¥å®ƒã€‚",
      "æ¯å¤©é€²æ­¥ä¸€é»é»ï¼Œå‹éåœæ»¯ä¸å‰ã€‚",
      "ç†±æ„›ç”Ÿæ´»ï¼Œç”Ÿæ´»æ‰æœƒå›å ±ä½ ã€‚",
      "ä¸è¦å®³æ€•æ”¹è®Šï¼Œæ”¹è®Šæ˜¯æˆé•·çš„é–‹å§‹ã€‚",
      "å¤¢æƒ³ä¸æ˜¯ç©ºæƒ³ï¼Œè€Œæ˜¯è¡Œå‹•çš„é–‹å§‹ã€‚"
    ];
    function showQuote() {
      const idx = Math.floor(Math.random() * quotes.length);
      document.getElementById('dailyQuote').textContent = quotes[idx];
    }

    // æ–°èç°¡å ± (NewsAPI)
    // è«‹å…ˆç”³è«‹ https://newsapi.org å…è²»API KEY
    const newsApiKey = 'a884a483999c4ef6b89fdf13b4c0a072';

    async function loadNews() {
      try {
        const res = await fetch(`https://newsapi.org/v2/top-headlines?country=tw&apiKey=${newsApiKey}`);
        const data = await res.json();
        const list = document.getElementById('newsList');
        list.innerHTML = '';
        if (!data.articles || data.articles.length === 0) {
          list.innerHTML = '<li>æ‰¾ä¸åˆ°æ–°è</li>';
          return;
        }
        data.articles.slice(0, 5).forEach(article => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${article.url}" target="_blank" rel="noopener">${article.title}</a>`;
          list.appendChild(li);
        });
      } catch(e) {
        document.getElementById('newsList').innerHTML = '<li>æ–°èè¼‰å…¥å¤±æ•—</li>';
        console.error(e);
      }
    }

    // è‚¡å¸‚æŸ¥è©¢ - ä½ åŸæœ¬çš„TWSE API
    async function loadStock() {
      const symbol = document.getElementById("symbolInput").value.trim();
      if (!symbol) {
        alert("è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼");
        return;
      }
      try {
        const searchResp = await fetch(`https://www.twse.com.tw/zh/api/codeQuery?query=${symbol}`);
        const searchData = await searchResp.json();

        if (!searchData.suggestions || searchData.suggestions.length === 0) {
          alert("æŸ¥ç„¡æ­¤è‚¡ç¥¨ä»£ç¢¼");
          return;
        }

        const firstSuggestion = searchData.suggestions[0];
        const [code, name] = firstSuggestion.split("\t");

        document.getElementById("name").textContent = name;
        document.getElementById("code").textContent = code;

        const today = new Date();
        const dateStr = `${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, "0")}${String(today.getDate()).padStart(2, "0")}`;

        const priceResp = await fetch(`https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=json&date=${dateStr}&stockNo=${code}`);
        const priceData = await priceResp.json();

        if (priceData.stat !== "OK" || !priceData.data || priceData.data.length === 0) {
          alert("ç„¡æ³•å–å¾—åƒ¹æ ¼è³‡æ–™");
          return;
        }

        const last20 = priceData.data.slice(-20);
        const labels = last20.map(d => d[0]);
        const closePrices = last20.map(d => parseFloat(d[6].replace(/,/g, '')));
        const volumes = last20.map(d => parseInt(d[1].replace(/,/g, ''), 10));

        const latestPrice = closePrices[closePrices.length - 1];
        const yesterdayClose = closePrices[closePrices.length - 2];
        const latestVolume = volumes[volumes.length - 1];
        const yesterdayVolume = volumes[volumes.length - 2];

        document.getElementById("price").textContent = latestPrice;
        document.getElementById("yesterdayClose").textContent = yesterdayClose;
        document.getElementById("volume").textContent = latestVolume.toLocaleString();
        document.getElementById("yesterdayVolume").textContent = yesterdayVolume.toLocaleString();

        const changeAmount = (latestPrice - yesterdayClose).toFixed(2);
        const changePercent = ((changeAmount / yesterdayClose) * 100).toFixed(2);
        const changeSpan = document.getElementById("change");
        changeSpan.textContent = `${changeAmount} (${changePercent}%)`;
        if (changeAmount > 0) {
          changeSpan.className = 'stock-up';
        } else if (changeAmount < 0) {
          changeSpan.className = 'stock-down';
        } else {
          changeSpan.className = '';
        }

        if (window.myChart) window.myChart.destroy();

        const ctx = document.getElementById('chart').getContext('2d');
        window.myChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'æ”¶ç›¤åƒ¹',
              data: closePrices,
              borderColor: 'blue',
              backgroundColor: 'rgba(0,0,255,0.1)',
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: false }
            }
          }
        });

      } catch (error) {
        alert("éŒ¯èª¤ç™¼ç”Ÿï¼Œè«‹ç¨å¾Œå†è©¦");
        console.error(error);
      }
    }

    // è¨ˆç®—æ©ŸåŠŸèƒ½
    function calculate() {
      const input = document.getElementById('calcInput').value;
      try {
        // eslint-disable-next-line no-eval
        const result = eval(input);
        document.getElementById('calcResult').textContent = 'çµæœï¼š' + result;
      } catch {
        document.getElementById('calcResult').textContent = 'éŒ¯èª¤ï¼šè«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­¸è¡¨é”å¼';
      }
    }

    // å€’æ•¸è¨ˆæ™‚å™¨åŠŸèƒ½
    let countdownTimer = null;
    function startCountdown() {
      if (countdownTimer) clearInterval(countdownTimer);
      let seconds = parseInt(document.getElementById('countdownInput').value);
      if (isNaN(seconds) || seconds <= 0) {
        alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ç§’æ•¸');
        return;
      }
      const display = document.getElementById('countdownDisplay');
      display.textContent = seconds;

      countdownTimer = setInterval(() => {
        seconds--;
        display.textContent = seconds;
        if (seconds <= 0) {
          clearInterval(countdownTimer);
          display.textContent = 'æ™‚é–“åˆ°ï¼â°';
          alert('å€’æ•¸è¨ˆæ™‚çµæŸï¼');
        }
      }, 1000);
    }

    // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
    window.onload = () => {
      loadWeather();
      showQuote();
      loadNews();
    };
  </script>

</body>
</html>
